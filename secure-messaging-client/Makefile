# Makefile for Secure Messaging Client with Kyber768

.PHONY: help build clean test run install-deps check-deps

# Default target
help:
	@echo "ðŸ” Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¢Ù…Ù† Ù…Ø¹ Kyber768"
	@echo "=================================="
	@echo ""
	@echo "Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…ØªØ§Ø­Ø©:"
	@echo "  build        - Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"
	@echo "  clean        - ØªÙ†Ø¸ÙŠÙ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡"
	@echo "  test         - ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª"
	@echo "  run          - ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"
	@echo "  install-deps - ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª"
	@echo "  check-deps   - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª"
	@echo "  help         - Ø¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©"

# Check dependencies
check-deps:
	@echo "ðŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª..."
	@which rustc > /dev/null || (echo "âŒ Rust ØºÙŠØ± Ù…Ø«Ø¨Øª" && exit 1)
	@which cargo > /dev/null || (echo "âŒ Cargo ØºÙŠØ± Ù…Ø«Ø¨Øª" && exit 1)
	@pkg-config --exists liboqs 2>/dev/null || (echo "âŒ liboqs ØºÙŠØ± Ù…Ø«Ø¨Øª" && echo "ðŸ’¡ Ø±Ø§Ø¬Ø¹ build-instructions.md" && exit 1)
	@echo "âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ù…Ø«Ø¨ØªØ©"

# Install dependencies (Ubuntu/Debian)
install-deps:
	@echo "ðŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª..."
	sudo apt-get update
	sudo apt-get install -y build-essential cmake git pkg-config
	sudo apt-get install -y liboqs-dev
	@echo "âœ… ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª"

# Build the application
build: check-deps
	@echo "ðŸ”¨ Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚..."
	cargo build --release
	@echo "âœ… ØªÙ… Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­"

# Clean build files
clean:
	@echo "ðŸ§¹ ØªÙ†Ø¸ÙŠÙ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡..."
	cargo clean
	@echo "âœ… ØªÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ"

# Run tests
test: check-deps
	@echo "ðŸ§ª ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª..."
	cargo test
	@echo "âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª"

# Run the application
run: build
	@echo "ðŸš€ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚..."
	./target/release/secure-messaging-client

# Development build
dev: check-deps
	@echo "ðŸ”¨ Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„ØªØ·ÙˆÙŠØ±..."
	cargo build
	@echo "âœ… ØªÙ… Ø§Ù„Ø¨Ù†Ø§Ø¡ Ù„Ù„ØªØ·ÙˆÙŠØ±"

# Check code
check: check-deps
	@echo "ðŸ” ÙØ­Øµ Ø§Ù„ÙƒÙˆØ¯..."
	cargo check
	cargo clippy
	@echo "âœ… ØªÙ… ÙØ­Øµ Ø§Ù„ÙƒÙˆØ¯"

# Format code
fmt:
	@echo "âœ¨ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¯..."
	cargo fmt
	@echo "âœ… ØªÙ… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚"

# Install to system
install: build
	@echo "ðŸ“¥ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚..."
	sudo cp target/release/secure-messaging-client /usr/local/bin/
	@echo "âœ… ØªÙ… Ø§Ù„ØªØ«Ø¨ÙŠØª ÙÙŠ /usr/local/bin/"

# Uninstall from system
uninstall:
	@echo "ðŸ—‘ï¸ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚..."
	sudo rm -f /usr/local/bin/secure-messaging-client
	@echo "âœ… ØªÙ… Ø§Ù„Ø¥Ø²Ø§Ù„Ø©"

# Show version
version:
	@echo "ðŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ØµØ¯Ø§Ø±:"
	@echo "Rust: $(shell rustc --version)"
	@echo "Cargo: $(shell cargo --version)"
	@echo "liboqs: $(shell pkg-config --modversion liboqs 2>/dev/null || echo "ØºÙŠØ± Ù…Ø«Ø¨Øª")"
